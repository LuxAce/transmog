<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Finding Aid Converter</title>

    <script src="js/jquery-2.1.3.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script type="text/javascript">

        var schemaList;

        $(document).ready(function(){
            $.ajax({ url: "service/findingaids/schema",
                context: document.body,
                success: function(json) {
                    schemaList = json;
                    for (var key in json) {
                        $('#profile').prepend($('<option>' + key + '</option>'))
                        $('#upload_button').submit(uploadFile);
                    }
                }});
        });

        function uploadFile() {
            var update_file = document.getElementById("file").files[0];
            var schema_id = $("#profile").val();
            var reader = new FileReader();
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var docid = xhr.getResponseHeader('Content-Location');
                        docid = docid.substring(docid.indexOf('/') + 1);
                        location = "service/findingaids/" + docid + "/edit";
                    } else {
                        alert("Error submitting file!");
                    }
                }
            };

            xhr.open( "POST", "service/findingaids/" + update_file.name + "?schemaId=" + schema_id);

            xhr.setRequestHeader("Content-type", update_file.type || "application/octet-stream");
            reader.onload = function(e) {
                var result = e.target.result;
                var data = new Uint8Array(result.length);
                for (var i = 0; i < result.length; i++) {
                    data[i] = (result.charCodeAt(i) & 0xff);
                }
                xhr.send(data.buffer);
            };
            reader.readAsBinaryString(update_file);
        }

    </script>

</head>
<body>
  <div class="container">
    <div class="header">
        <!--
        <nav>
            <ul class="nav nav-pills pull-right">
                <li role="presentation" class="active"><a href="#">Home</a></li>
                <li role="presentation"><a href="#">About</a></li>
                <li role="presentation"><a href="#">Contact</a></li>
            </ul>
        </nav>
        -->
        <h3 class="text-muted">Finding Aid Processor</h3>
    </div>

    <div class="row" id="load-options">
        <div class="col-lg-6">
            <h4>Start a NEW document</h4>
            <p>Upload a word document to serve as the starting point for your new structured XML document.</p>

            <form action="javascript:uploadFile()">
                <div>
                    <label for="profile" class="control-label">Profile</label>
                    <select id="profile"></select>
                </div>
                <div>
                    <label for="file" class="control-label">File</label>
                    <input type="file" id="file" />
                    <input type="submit" class="btn btn-default" value="Upload" id="upload_button">
                </div>
            </form>
        </div>
    </div>
  </div> <!-- /container -->
</body>
</html>